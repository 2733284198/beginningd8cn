## 视图 

 如果你问使用过Drupal一段时间的人，什么是必杀技模块。这个答案很可能是视图，面板，或者自定义内容类型。在这个列表中，视图通常是最先提到的。很多用户说不能没有视图模块。视图模块有什么特别的地方昵？简单的说，视图为你提供了一个易于选择和操作的界面,用于显示在你网站的内容列表。

你可能使用的视图示例

* 在你的网站显示最新发布的文章，通过时间进行升降排序。
* 在一张表中列出许多公司的地理位置，通过点击公司地理位置，城市，州和国家的标题进行排序
* 显示图片库
* 显示幻灯片
* 显示日历
* 显示博客文章列表，并通过主题进行筛选
* 创建一个RSS feed，呈现你的网站最新发布的最新内容
* 显示你能想到的任何类型的的列表，创建表单和内容并储存在你的网站中，像列表，RSS feed，在第五章钟，我们创建事件内容类型。让我们创建一些时间列表，并把它放在工作中。将对访问者使用视图模块是有帮助的。如果你没有完成第五章的。现在是一个极好的时间回到第五章。通过实例来工作。以便于有所需的内容来支持你将来的活动

## 视图模块

视图模块在Drupal8中是核心模块，默认情况下已安装并开启。
为了验证视图模块已经安装并开启，点击页面上的管理链接中扩展选项中的子菜单。在扩展页面搜索功能。输入视图进行搜索。如果这个视图模块存在，你应该看到2个模块列表 如图 9-1 所示。如果复选框没有被勾选。请勾选并点击"保存配置"按钮。

![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/1b0e682045aabe6f4a601c7f3712d791.png)

			图9-1。验证查看已安装并启用
			
这个视图模块是幕后组件。用来从处理数据库中的读取的内容，并显示出来。这个视图UI模块，UI在这代表用户界面。是管理员创建和配置形成视图界面。我们将在本章其余的部分来讲解视图UI。

## 创建一个视图

随着视图安装并开启。我们已经准备好了。但是一个视图没有内容，那么，仅仅是一个空白页。所有第一步创建一些内容。在本章我们已经有几篇先前创建好的文章。所有让我们使用这些作为我们首次涉足的观点。如果你跳过前面的练习或者已经删除那些你创建的文章。然后在花一点时间创建几篇。

我们现在已经创建一个文章列表的视图。点击页面上的管理链接，在二级菜单结构链接中的视图链接。它将跳转到视图管理界面。你将在页面上看到几个已有的观点。这些观点时Drupal的核心组成部分，提供最新的内容列表，最近的评论，新用户，谁在线，以及其他的信息。如果你通过第八章的学习，你会认识到这些观点。像这些观点，我们会在这一章节使用几个区块来展示。

要添加一个视图，在页面上点击“添加新的视图”按钮。它揭示了一个新的视图(参见图9-2)。在这页，定义如下：

* 视图名称：这个名称必须是唯一的(尚未在网站中另一个视图中使用)。选择一个描述名称是一个好主意，让其他人看到这个列表描述可以更轻松正确的使用描述名称。对于第一种观点，用最近的文章最为名称。
* 说明：这又是一个字段，你可以使用它来提供更多视图信息。勾选旁边的描述，然后输入“网站上发布的的最新文章列表”。
* 查看设置：这组字段定义将由什么类型的内容来呈现视图。如果你点击展示列表，你将看到不同的选项，例如内容，日志，文件，评论，内容修改版本，分类(术语)，和用户。我门的观点聚焦在文章类容。在标记字段限制我们的提供的视图仅仅包含这些条款。我们将跳过标签字段到排序选项。选择未分类(我将在后面来整理这个例子)。

## 创建你的第一个视图

* 页面设置：视图提供创建内容的列表功能，在你的网站上通过一个URL访问一个单独的列表页面的的功能。出于演示，勾选"创建一个页面"框。你必须填写页面标题(或者般流默认值)和输入链接到列表中的URL路径(或保留默认值)。在显示的格式中，类似于没有格式化列表中的摘要，设置项目呈现10条条目数量。点击分页，它将呈现文章列表。如果 在文章列表超过10篇文章，一个分页器将出现在文章列表底部，以便于浏览者查看所有的文章，每页仅显示10篇文章。
* 区块设置：虽然我们学习了区块在第八章。但是出于学习的目的。我们将允许我们的视图创建一区块(放在一个页面的任何地方)。显示该区块最新的三个事件。点击"创建一个区块"框，输入区块标题名称(或保持默认值)，将保留格式保留为格式化标题列表名称(链接)。将项目组第三个“使用这个”复选框选中。

![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/b0f1bed735fc8b23827ca4154d55259c.png)

				图9-2。创建新视图	
				
点击“保存并修改”按钮。会跳转到下一个配置视图页面。如图9-3所示。


![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/47751063535d35a7d69b5c4d8028ccde.png)

				图9-3。视图编辑页面
				
乍一看，定义一个视图的形式看起来很复杂，幸运的事，这是表面的假象。

首先你将会看到视图配置上的一个列表，在我们的例子里，我们有一个页面和一个区块。视图的强大功能之一是一个单一的视图可以呈现多个显示的功能。我们可能会使用的最近的文章类型作为例子，它包括：

* 在网站上显示所有文章，并显示每一篇发布的文章详情。
* 一个区块列出最近5篇文章，每一篇文章只显示的标题 
* 另一个区块显示最近5篇文章，每一篇文章显示的标题和内容简介
* 还有一个区块显示最近10篇文章，显示文章的标题，发布日期，编写作者和内容简介。

这是一个简单的视图用于创建几种不同内容类型，每个类型在文章中都呈现不同的格式。

我们将开始定义2个显示区，页面和区块。当我们第一次选择配置视图(参见图9－2），它们将通过视图自动被创建。__通过前两个步骤的工作，我们将添加到显示列表__。

##页面显示

首先让我们定义这个页面显示。点击页面显示配置下面的__页面__按钮，在页面之上我们将完成文章的标题，内容，作者，发布状态和时间及日期。让我们从上到下，从左到右配置我们需要的页面显示参数。

1. 从修改页面显示的名称到到更多的描述，像"所有文章页面"，到改变这个值，点击"__页面__"右侧的页面名称。并在弹出框中的管理描述字段输入新的值。接着点击应用按钮。我们将看到这个新的值.呈现在视图编辑区域并左侧栏位"显示名称字段"视图名字字段的左侧栏。
2. 在这个区域，改变视图的的标题，这个值会在视图顶部直接输出。然而让我们改变"所有文章"。点击"最近的文章"，从列表中选中"此页面(覆盖)"，这个意味着我们改变的这个值仅仅应用这个特别的视图显示。如果你设置成"显示所有",每一个视图都将显示这个新的标题。因为不同的目的，我们会有不同的显示。"所有文章"在选择标题后，对其他显示器是不友好的。
3. 在格式区域。我们可以使用有不同的输出生成一个列表。点击"格式化的列表"会看到一个输出格式列表选项：

	* 网格(表格)：输出显示行和列。在我们的例子中，每一篇文章将填充一行网格(表格)。对于图片库这是一个好的选择显示图片。
	* HTML列表：输出一个有序或者无序列表。在我们的例子中，每一篇文章将会显示在列表中封闭的"__ol__ __li__" 或者 "__ul__" 标签内。如果没有类似的HTML标签，如果你不熟悉HTML标签,在<http://www.w3schools.com/html>查看这个伟大的教程或者拿起一本伟大HTML开发入门书籍在<http://www.apress.com>。
	* 表：作为一个HTML输出显示。每一个字段显示一列。当你想提供一列的值来排序输出表，这是一个好的表。
	* 没有格式化的列表：作为一个列表显示，但是不像HTML列表，这儿没有 __ul__ , __ol__ 或者 __li__ 标签。在我们的页面例子中，我们设置无序列表。当改变这个值除了"没有格式化列表",记住在这个列表中选中"此页(覆盖)".如果你点击设置右侧的"没有格式化的列表"，你将看到这个配置所有的有效的类型选项。每一个参数都有自己的选项供你设置。
4. 在格式部分，我们定义了参数要如何处理我们想要展示的内容。内容和字段时最常用的内容选项。
	* 内容：显示当前正在选择的完整实体。在这些文章案例中，这个完成的文章将被展示出来。
	* 字段：使你显示特别的字段的实体进行渲染。在我们的例子中，我们正在选择和现实的文章。我们可以有一个我们想要展示的文章标题和发布日期视图。使用字段选项，我们可以展示特别的字段，以及这些字段在页面的显示顺序。在我们的页面例子中。我们将选择内容展示。像摘要，一个文章截取版本，显示600字符集。当我们在摘要模式定义了我们要设置的页面显示内容。所有展示我们已经设定的值。如果我们想要通过这个视图来渲染这个实体文章。我们点击这个摘要文字，__ 在视图模式列表中默认为"默认值"中选择. __ 。对于我们示范的目的，在显示模式中设置摘要显示。
5. 在我们的例子中，这个字段配置参数没有被显示，因为我们将显示整个文章。当我们创建显示区块，在本章之后，我们将覆盖这些字段。
6. 过滤标准在下一个配置区域。你可以通过添加视图显示的过滤标准，来渲染这个内容显示。当我们创建这个视图(参见图9－2)时，在第一个配置屏幕上，我们选中这个视图，并设置仅显示文章。通过选择文章，我们设置了一个过滤仅仅显示文章内容类型。此外，视图也为发布(未发布)的内容创建过滤条件。在我们的视图中我们会添加别的过滤标准；例如，在文章案例中，我们可能想一个显示视图仅仅展示最近30天发布的文章。我们可以通过添加任何一方面的过滤标准来限制储存在项目中值的输出。出于演示的目的，我们将当读设置过滤标准。当我们创建显示区块时，在本章之后将覆盖添加的的过滤标准。
7. 这个排序部分提供了特定的内容列表排序。在默认情况下，这个值将通过节点ID(通常在Drupal内容项目中的唯一标示)的顺序排序。你想要设置一个标题排序标准，按照这个列表你想按照字母排序，或者通过最新发布的文章列表的日期排序。让我们在标题中添加一个排序标准。点击排序标签右侧的添加按钮，你将在你的网站上看到你定义的所有字段的一个完整列表，__ 我们想要过滤这个列表名字中的"标题"。__ 。这样做，进入"标题"来搜索字段和在列表字段中选择"内容：标题"，向下滚动，知道你发现 __内容：标题__,检查该字段的复选框，在本页顶部选择之的改变，然后点击"应用"按钮。在下一个屏幕允许设置这个排序，上升或者下降，也向网站访问者公开这个选项。在这个实例页面中，不检查没有选择的复选框。我们想要按照这个标题排序。点击"应用(显示)"按钮继续。滚动到屏幕底部，你现在应该看到这个页面将如何输出显示。在第二列的配置选项里（参见图9-3），我们将开始为我们的列子定义页面设置。
8. 每个显示视图作为页面被定义，并且有一个唯一的URl。特别是路径字段中。在我们的例子中，让我们用"/all-articles(全篇)"作为URL。点击"没有路径被设置"，在这个"这个菜单路径或网址"表单输入所有文章路径文本字段。点击应用按钮继续。
9. 菜单字段提供给我的选项来添加我们的视图显示页面到一个菜单。出于演示的目的，我们将添加它到这个"主导航"菜单。点击"无菜单"参数，然后点击"普通菜单"选项。在这个配置页面添加菜单项，输入标题，描述和选择"主导航"菜单作为这个项目菜单。对于你的网站建设，你可能想要作为一个菜单添加到一个视图页面而不是"主导航"菜单.在表单上输入值后点击应用按钮。
10. 视图提供了限制谁能看到这个输出的显示视图。你可以设置的访问限制
	* 无：任何人都能看到输出。
	* 权限 ： 这个访问者必须是被分配一个有权限角色才能看到输出。
	* 作用 ： 这个访问者必须被分配特别的角色才能看到这个输出。
	通过定义这个被设置的权限。这个默认权限是访问者要有访问网站视图内	容的权限（见图9-3）。在大多数默认值时合适的。在我们的示例页面，	我们将把他们设为默认值。仅仅有权限的访问者能看到视图内容输出。
11. 在头设置，你可以在你的视图顶部添加一些东西。例如，你可以创建一个介绍性的段落，通过内容描述渲染视图，或在你网站上定义一个区块，输出另一个视图，或几个其他元素。点击添加按钮和选择列表中的选项。大多数相同的选项添加到介绍性的段落，这样做，点击"全局：文本区域"选项，在选择列表的顶部选择"这个页面(覆盖)"选项。点击"应用(所有显示)"按钮。在下一个表单中，输入你想要在视图中显示的文本。如果你想在头部文本显示即使在你的视图中没有值，检查这个"即使显示视图没有内容"的框，然后点击"应用(所有显示)"按钮。
12. 底部设置，像头部一样，你可以添加一个底部设置输出视图，然后像设置第11步一样添加一个底部视图。
13. 如果你的视图没有内容－－例如，在你网站上没被发布的文章－你可以提醒访问者，在你设置之前提示没有内容存在的消息。创建消息跟创建头信息和底部信息一样。当没有内容时按照步骤11添加一个信息。
14. 如果你的视图返回一个很长的列表。考虑到在底部视图使用的分页。限制显示的数量在任何给定的时间范围。例如，一个视图可能返回100个内容项，而不是显示所有100个内容作为一个很长的列表。你可以使用分页展示，一次显示10项，分页显示在视图显示内容列表底部，这个分页配置选项也提供特别的数量项(例如，3个最新文章)，或列出所有适合的筛选条件列表项。在第三列（参见图9-3），有几个高级配置选项，我们将关注其中2个，要显示的选项，点击高级配置选项。
15. 上下文配置器时一个功能强大的配置选项，允许你利用网页中传递的值，进行过滤，返回给的视图。例如，我们希望限制返回我们所标记过的特定的分类文章。如果我们的文章内容类型有"事件"分类词汇作为一个字段编辑用于特别的分类文章相关联，我们会使用网站传递的值来过滤文章的显示。通过选择的一个上下文过来"已有的分类项ID"，然后为文章设置内容类型，分类词汇和过滤值类型转换成项目名字或项目ID，你现在可以更新这个路径成" __全部文章/%__,这里的"__%__"代表通过网址传递过来的一个值。我们可以认为有一个视图可以通过分类词汇显示任何文章。这个单一的视图可以通过"__/all-articles/drupal__(/所有文章/drupal)"来渲染关于Drupal文章列表。或者通过__/all-articles/dinosaurs(/所有文章/恐龙)，或者是我们的分类词汇的任何一种术语。大神奇了！为了简单起见，在我们的例子中不使用上下文来过滤。
16. 在案例中使用关联，你需要从2个不同内容类型来满足特定的视图要求。例如，你有一个类容类型，列出来地址，操作时间和辅助选项。而不是每个事件上键入的信息都在发生在那个地方。 你可以在事件内容类型和地点内容类型之间建立关联，使两个内容类型中存储的信息结合起来，这样可以代替在每个某地的事件中添加信息说明。你已经在你的显示视图中内容类型创建过一次有效的关联字段。因为我们很简单，我们现在设置这个关联。在这一点上，我们准备测试我们的视图。运行程序之前确保你点击了保存按钮。在保存之后，返回到你网站的首页，然后你应该在你的主导航菜单看到所有的文章链接（如果你使用Bartik主题，他应该在屏幕上出现一个标签）。点击所有文章链接(或标签)，你将看到你的劳动成果(参见图9－4)。

## 区块显示
![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/3a0d83689be6206f59a5ab73520aefa3.png)
		
				图9-4。所有文章查看页面
				
### 区块显示

随着文章页面显示我们的所带的区块，现在让我们修改这个区块显示。通过导航到管理 》结构 》视图 返回管视图理页面。查找最近的文章视图，点击操作栏中的编辑链接。你现在应该看到最近的文章视图配置页面（参见图9-3）。

在这个过程中的第一步时点击视图列表中的区块按钮。你应该能够直接找到文章页按钮。点击区块按钮显示区块所有配置参数，让我们来更新这个显示，让它仅仅显示最近3篇文章标题并按照发布时间排序，降序以便于最近一篇文章显示在页面顶部。让我们先从更新一些更具描述性的名称开始，接着做一些我们需要的做的来改变区块本身：

1. 在第一栏中，"显示名称"，点击区块改变"行政名称"字段的值为"最近的文章区块".
2. 设置标题为最近的文章，因为它仍然适用于所要显示的区块。
3. 设置格式化为"为为格式化的列表"，因为我们仍然想要文章显示为一个列表。
4. 改变显示选项为字段，因为我们仅仅想在我们列表中显示文章标题。
5. 在字段区域，设置显示标题选项。如果它没有显示标题。点击添加按钮，在那个区域搜索这个标题，添加到区块显示。
6. 在过滤标准区域，设置内容发布状态显示已经发布的内容和内容类型设置为文章内容类型。
7. 在排序标准区域，点击添加按钮，搜索日期。你将看到"内容：发布日期"在列表选项里。检查这个字段旁的复选框，改变这个选项值为"这个区块（覆盖）"，在底部点击"应用（显示所有）"。出现在下一个表单上，选择"倒序排序"，因为我们想在列表顶部显示最新文章文章，最旧的文章在底部。应用这些改变。
8. 最后，我们要在第二列最后三个配置选项改变值来限制文章显示数量。检查确保使用"分页"值来设置每页显示一个特定数目的项目，例如3项。"当我们设置我们特定的值在视图上"。点击保存按钮。你现在准备吧你刚刚在网站上创建的一个块放到一个页面上。页面上的导航到结构，然后点击"区块布局"链接。在"区块布局"页面上，在这个"区块地点"栏里，你可以看到你想创建的视图显示列表，见下面的（视图）列表区域，（如图9-5）。
![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/36ecb9de52cd4b62e69c87b7e7c4c52e.png)
	
		图9-5。列表（查看）块

点击最近的文章：最近的文章区块链接，分配一个区域。现在列表上的一个区域后，保存这个区块。返回你网站首页。你应该高兴的看到通过你创建并使用的视图区块中的文章列表。（如图9-6）。

## 过滤
![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/ae9300652c05d1a7ec6701b608a21d41.png)
	
		图9-6。该网页显示最近的文章块列表

### 过滤

在前面的例子中，我们基于内容和发布状态过滤输出我们的视图。这些都是最经典的过滤视图显示。但是你是否想限制输出视图显示超出内容和状态？让我们。让我们以标签为例来演示过滤器的强大。在本节中，在我们网站上我们将添加一个标签例如文章。编辑几篇你的文章，在标签字段，输入几个关键字，并用逗号分开，描述每篇文章的内容。至少在你的两篇文章上使用类似的关键词以便于我们在后面的例子中使用这些文章。为了找到更新的文章，在主菜单中点击内容链接，在表单列表上点击编辑按钮添加标签到现有文章。添加标签之后，返回我们之前章节创建的文章页面。你添加的标签现在显示在每一篇摘要下面。（如图9-7）。
![Mou icon](http://work.beiweng.org/d/file/drupal/chapter9/2016-04-09/6c894728dae375e535cd5fdc7d25e2f3.png)

		图9-7。通过视图渲染标签
As a quick demonstration of the power of taxonomy, tags, and views, click one of the tags that you entered and Drupal will render a list of all content tagged on your site with that term. Behind the scenes, Drupal is using Views to generate this list. But let’s take it one step further and allow users to filter content that is rendered from our All Articles view by entering a tag.
	


	